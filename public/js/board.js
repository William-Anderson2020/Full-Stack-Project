!function(t){var e={};function s(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,s),o.l=!0,o.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)s.d(i,o,function(e){return t[e]}.bind(null,o));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);let i=[];class o{constructor(t,e,s){this.x=t,this.y=e,this.terrain=s}}class a{constructor(t,e){this.type=t,this.stats=e}}const c=new a("Mountain",{spMvt:["flier"]}),n=new a("Forest",{def:2});function r(t,e){let s=[];return t.forEach(t=>{t[1].forEach(i=>{s.push(new o(t[0],i,e))})}),s}i.push(new class{constructor(t,e){this.name=t,this.tiles=e}}("Demo",r([[2,[1]],[3,[1,5,6]],[4,[5,6,7]],[5,[2,3]],[6,[1,2,3,7]],[7,[7,8]],[8,[6]]],n).concat(r([[2,[5,6]],[3,[2,4,7]],[4,[1,2,8]],[5,[1,7,8]],[6,[8]],[7,[2,3,4,8]],[8,[2,3,7,8]],[9,[7,8]]],c))));let l=[],u=[],p=!1,d=i[0];!function(t,e){for(let s=t;s>0;s--){document.getElementById("container").insertAdjacentHTML("afterbegin",`<div id="row${s}" class="row"></div>`);for(let t=e;t>0;t--)document.getElementById(`row${s}`).insertAdjacentHTML("beforeend",`<div class="tile" x="${s}" y="${t}"></div>`)}}(10,10);let f,m=document.querySelectorAll(".tile");function h(t){l.forEach(e=>{e.x==t.pos.x&&e.y==t.pos.y&&(e.occupied={isOccupied:!0,unit:t},t.pos.tile=e,e.dom.innerHTML=`<img class="board_sprite" src=${t.img}>`,u.push(e),l.forEach(t=>{t.occupied.unit==e.occupied.unit&&t.occupied.unit!={}&&t!=e&&(u=u.filter((function(e){return e!=t})),t.occupied.isOccupied=!1,t.occupied.unit={},t.dom.classList.remove("active"),(t.x<e.x||t.x==e.x&&t.dom.classList.contains("flip"))&&e.dom.classList.add("flip"),t.dom.innerHTML="",t.dom.classList.remove("flip"))}))})}function b(t,e){let s=[];return l.forEach(i=>{Math.abs(i.x-t.x)+Math.abs(i.y-t.y)<=e&&s.push(i)}),s}function y(t){let e=[],s=[];return b(t.pos.tile,1).forEach(i=>{if("Mountain"==i.terrain.type||1==i.occupied.isOccupied&&i.occupied.unit.owner!=t.owner)return;let o=b(i,1);for(let i=0;t.stats.mvt-1>i;i++)o.forEach(i=>{/*!(tile.spMvt && !tile.terrain.spMvt.includes(unit.spMvt)) &&*/"Mountain"==i.terrain.type||i.occupied.isOccupied&&i.occupied.unit.owner!=t.owner||(b(i,1).forEach(t=>{s.includes(t)||(o.push(t),s.push(t))}),e.includes(i)||e.push(i))})}),e}function g(t){let e=Object.assign({},t.stats),s=[];return t.item.stats!={}&&s.push(t.item.stats),t.pos.tile.terrain.stats!={}&&s.push(t.pos.tile.terrain.stats),s.forEach(t=>{Object.keys(t).forEach(s=>{e[s]+=t[s]})}),console.log(t.pos.tile.terrain),e}function x(t){let e;switch(t.weapon){case"sword":case"magic":e="t1";break;case"spear":e="t2";break;case"axe":e="t3";break;case"bow":wepaon="t3";break;default:e="t2"}return e}function k(t,e){!function(t,e){let s=b(e.pos.tile,t.stats.rng),i=s[0];Math.abs(t.pos.x-e.pos.x)+Math.abs(t.pos.y-e.pos.y)>1&&(s.forEach(e=>{console.log(e),e.dom.classList.contains("viable")&&Math.abs(e.x-t.pos.x)+Math.abs(e.y-t.pos.y)<=Math.abs(i.x+i.y-(t.pos.x+t.pos.y))&&(i=e)}),t.pos.x=i.x,t.pos.y=i.y,e.pos.x>t.pos.x&&!t.pos.tile.dom.classList.contains("flip")&&t.pos.tile.dom.classList.add("flip"),h(t)),t.pos.tile.dom.innerHTML=`<img class="board_sprite anim_sprite" src="${t.anim}">`,t.pos.x<e.pos.x?t.pos.tile.dom.classList.contains("flip")||t.pos.tile.dom.classList.add("flip"):t.pos.tile.dom.classList.contains("flip")&&t.pos.tile.dom.classList.remove("flip"),setTimeout(e=>{h(t)},1600)}(t,e),function(t,e){let s=[...arguments];s.forEach(t=>{t.cStats=g(t)});let i=1,o=1,a=0;a="magic"==t.weapon?e.cStats.res:e.cStats.def;let c=x(t),n=x(e);switch(c){case"t1":switch(n){case"t1":break;case"t2":i-=.2;break;case"t3":i+=.2}break;case"t2":switch(n){case"t1":i+=.2;break;case"t2":break;case"t3":i-=.2}break;case"t3":switch(n){case"t1":i-=.2;break;case"t2":i+=.2}break;default:console.log("weapon trianlge defaulting.")}Math.trunc(100*Math.random())<(t.cStats.lck+t.cStats.dex-e.cStats.lck)/2&&(o=1.5);let r=(t.cStats.atk+Math.trunc(t.cStats.atk*i)-a)*o;r<0&&(r=0),console.log(r),e.hp-=r,console.log(t.hp,e.hp),o>1&&console.log("Critical!")}(t,e)}function v(t){let e=function(t){let e;return l.forEach(s=>{s.x==t.getAttribute("x")&&s.y==t.getAttribute("y")&&(e=s)}),e}(t.target);if(1==e.occupied.isOccupied&&(e.dom.classList.contains("atkViable")&&e.occupied.unit.owner!=f.owner?k(f,e.occupied.unit):f=e.occupied.unit,l.forEach(t=>{t.dom.classList.remove("viable","atkViable")})),!u.includes(e)||1==p)return e.dom.classList.contains("viable")&&function t(e){let s=e;f.pos.x=s.x,f.pos.y=s.y,p=!1,h(f),l.forEach(e=>{e.dom.classList.remove("viable","atkViable"),e.dom.removeEventListener("click",t)})}(e),void l.forEach(t=>{t.dom.classList.remove("viable","atkViable"),p=!1});y(f).forEach(t=>{0==t.occupied.isOccupied&&t.dom.classList.add("viable"),p=!0}),y(f).forEach(t=>{b(t,f.stats.rng).forEach(t=>{t.dom.classList.contains("viable")&&(1!=t.occupied.isOccupied||t.occupied.unit.owner==f.owner)||t.occupied.unit.owner==f.owner||t.dom.classList.add("atkViable")})})}console.log(d),m.forEach(t=>{let e={dom:t,x:parseInt(t.getAttribute("x")),y:parseInt(t.getAttribute("y")),occupied:{isOccupied:!1,unit:{}},terrain:{type:"",stats:{mvtc:1}}};d.tiles.forEach(t=>{t.x==e.x&&t.y==e.y&&(e.terrain=t.terrain)}),l.push(e)}),h({img:"./img/ameliaIdle.png",anim:"./img/ameliaAtk.gif",name:"Amelia",hp:20,weapon:"spear",stats:{atk:3,def:2,mvt:2,rng:1,lck:2,dex:3},pos:{x:3,y:5,tile:{}},item:{name:"Training Sword",stats:{atk:1,hp:3}},owner:"Player 1"}),h({img:"./img/erikaIdle.png",anim:"./img/erikaAtk.gif",name:"Erika",hp:25,weapon:"sword",stats:{atk:2,def:1,mvt:3,rng:1,dex:20,lck:30},pos:{x:7,y:7,tile:{}},item:{name:"Wooden Shield",stats:{atk:1,def:2}},owner:"Player 2"}),l.forEach(t=>{t.dom.addEventListener("click",v)}),u.forEach(t=>{let e=t.occupied.unit;e.item.stats.hp&&(e.hp+=e.item.stats.hp)})}]);